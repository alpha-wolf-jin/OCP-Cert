{"meta":{"count":1,"records":1,"page":1,"pages":1},"data":{"attributes":{"interactives":[],"page_tag":"ch06s06","uuid":"certificates-troubleshoot-practice","title":"Guided Exercise: Troubleshooting OpenShift Certificates","media":[],"prev_tag":"ch06s05","prev_id":"certificates-troubleshoot-lecture","order":6,"content":{"html":"<div class=\"section\"><div class=\"titlepage\"><div><div><h2 class=\"title\" style=\"clear: both\"><a id=\"certificates-troubleshoot-practice\"></a>Guided Exercise: Troubleshooting OpenShift Certificates</h2></div></div></div><div class=\"task task_Checklist\" data-task=\"Checklist\">\n<div class=\"tasksummary\">\n<p>In this exercise, you will renew expired certificates and apply the renewed certificates to the default ingress controller operator and master API.</p>\n<p><strong>Outcomes</strong></p><p>You should be able to:</p>\n<div class=\"itemizedlist\"><ul class=\"itemizedlist\" style=\"list-style-type: disc; \"><li class=\"listitem\"><p>Identify expired OpenShift certificates.</p></li><li class=\"listitem\"><p>Configure the OpenShift cluster to use renewed certificates.</p></li></ul></div>\n</div>\n<div class=\"taskprerequisites\">\n<p>To perform this exercise, ensure you have access to:</p>\n<div class=\"itemizedlist\"><ul class=\"itemizedlist\" style=\"list-style-type: disc; \"><li class=\"listitem\"><p>A running OpenShift cluster.</p></li></ul></div>\n<p>On the <code class=\"code\">workstation</code> machine, use the <code class=\"code\">lab</code> command to prepare your system for this exercise.</p>\n<p>The command ensures that the cluster API is reachable and configures the cluster to use certificates that are set to expire one minute in the future.</p>\n<pre class=\"screen\">[student@workstation ~]$ <strong class=\"userinput\"><code>lab certificates-troubleshoot start</code></strong></pre>\n</div>\n<div class=\"procedure\"><a id=\"idm140292190885288\"></a><p class=\"title\"><strong>Procedure¬†6.3.¬†Instructions</strong></p><ol class=\"procedure\" type=\"1\"><li class=\"step\"><p>Review the TLS certificates for the ingress controller.</p><ol class=\"substeps\" type=\"1\"><li class=\"step\"><p>Log in to your OpenShift cluster as the <code class=\"code\">admin</code> user.</p><pre class=\"screen\">[student@workstation ~]$ <strong class=\"userinput\"><code>oc login -u admin -p redhat \\\n  https://api.ocp4.example.com:6443</code></strong>\nLogin successful.\n\n<span class=\"emphasis\"><em>...output omitted...</em></span></pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>You might receive a warning regarding using insecure connections.\nAnswer <code class=\"code\">y</code> to proceed.</p></div></li><li class=\"step\"><p>Change to the <code class=\"code\">~/DO380/labs/certificates-troubleshoot</code> directory.</p><pre class=\"screen\">[student@workstation ~]$ <strong class=\"userinput\"><code>cd ~/DO380/labs/certificates-troubleshoot</code></strong></pre></li><li class=\"step\"><p>Use the <code class=\"code\">curl</code> command to display information about the TLS certificate that secures traffic to the OpenShift web console.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>curl -v -k \\\n  https://console-openshift-console.apps.ocp4.example.com 2&gt;&amp;1 | \\\n  grep -E 'date|expired'</code></strong>\n*  start date: <em class=\"replaceable\"><code>Jun  9 12:49:23 2021</code></em> GMT\n*  <code class=\"code\">expire date: <em class=\"replaceable\"><code>Jun  9 12:50:23 2021</code></em> GMT</code>\n*  SSL certificate verify result: <code class=\"code\">certificate has expired</code> (10), continuing anyway.</pre><p>The certificate expired at the date and time listed on the <code class=\"code\">expire date</code> line.</p><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>The router pods in the <code class=\"code\">openshift-ingress</code> namespace must finish redeploying with the new (expired) certificate.\nIf you do not see a <code class=\"code\">certificate has expired</code> message, then wait for a minute and try again.</p></div></li><li class=\"step\"><p>If your enterprise CA signed the wildcard certificate for your OpenShift cluster, then the cluster-wide proxy stores certificate information in a configuration map.\nRun the <code class=\"code\">oc get</code> command to retrieve the name of the configuration map used by the cluster proxy.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc get proxy/cluster \\\n  -o jsonpath='{.spec.trustedCA.name}{\"\\n\"}'</code></strong>\nwildcard-bundle</pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>If you get an error regarding the X509 certificate being expired or signed by unknown authority, then try to log in to the cluster using the <code class=\"code\">--insecure-skip-tls-verify</code> flag, and execute the command again.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc login -u admin -p redhat \\\n  --insecure-skip-tls-verify https://api.ocp4.example.com:6443</code></strong></pre></div></li><li class=\"step\"><p>Extract the <code class=\"code\">wildcard-bundle</code> configuration map to the current directory.\nThe <code class=\"code\">--confirm</code> option overwrites the file if it already exist in the destination.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc extract \\\n  configmap/wildcard-bundle -n openshift-config --to ./ --confirm</code></strong>\nca-bundle.crt</pre></li><li class=\"step\"><p>Use the <code class=\"code\">openssl</code> command to read the certificates.\nThe <code class=\"code\">-dates</code> option displays the dates and times of certificate validity; the <code class=\"code\">-serial</code> option displays the certificate serial number.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>openssl x509 \\\n  -in ca-bundle.crt -noout -subject -issuer -dates -serial</code></strong>\nsubject=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, <code class=\"code\">CN = *.apps.ocp4.example.com</code>\nissuer=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, CN = GLS Training Classroom Certificate Authority\nnotBefore=<em class=\"replaceable\"><code>Oct 29 00:14:45 2021</code></em> GMT\n<code class=\"code\">notAfter=<em class=\"replaceable\"><code>Oct 29 00:15:45 2021</code></em> GMT</code>\nserial=<em class=\"replaceable\"><code>7ECC993EB3CF0E8942A92B687D9F5152CB730727</code></em></pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>Although your certificate for <code class=\"code\">CN = *.apps.ocp4.example.com</code> displays different information, expect that the <code class=\"code\">notAfter</code> date (in GMT) is in the past.</p><p>The <code class=\"code\">ca-bundle.crt</code> file has two certificates and <code class=\"code\">openssl</code> only reads the first one.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>grep '^#' ca-bundle.crt</code></strong>\n# Classroom Wildcard Certificate\n# GLS Training Classroom Certificate Authority</pre></div></li><li class=\"step\"><p>Run the <code class=\"code\">oc get</code> command to retrieve the ingress controller secret name.\nThe secret contains the TLS certificate and the associated private key.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc get \\\n  ingresscontroller/default -n openshift-ingress-operator \\\n  -o jsonpath='{.spec.defaultCertificate.name}{\"\\n\"}'</code></strong>\nwildcard-tls</pre></li><li class=\"step\"><p>Extract the <code class=\"code\">wildcard-tls</code> secret and save the output on the current directory.\nThe <code class=\"code\">--confirm</code> option overwrites the files if they already exist in the destination.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc extract secret/wildcard-tls \\\n  -n openshift-ingress --to ./ --confirm</code></strong>\ntls.crt\ntls.key</pre></li><li class=\"step\"><p>Use the <code class=\"code\">openssl</code> command to read the certificate.\nThe <code class=\"code\">-dates</code> option displays the dates and times of certificate validity and the <code class=\"code\">-serial</code> option displays the certificate serial number.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>openssl x509 -in tls.crt \\\n  -noout -subject -issuer -dates -serial</code></strong>\nsubject=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, <code class=\"code\">CN = *.apps.ocp4.example.com</code>\nissuer=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, CN = GLS Training Classroom Certificate Authority\nnotBefore=<em class=\"replaceable\"><code>Oct 29 00:14:45 2021</code></em> GMT\n<code class=\"code\">notAfter=<em class=\"replaceable\"><code>Oct 29 00:15:45 2021</code></em> GMT</code>\nserial=<em class=\"replaceable\"><code>7ECC993EB3CF0E8942A92B687D9F5152CB730727</code></em></pre><p>The dates and <code class=\"code\">serial</code> line match the output from the <code class=\"code\">ca-bundle.crt</code> certificate.\nThe <code class=\"code\">notAfter</code> line indicates that the certificate expired just after starting this exercise.</p><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>The <code class=\"code\">tls.crt</code> file has two certificates and <code class=\"code\">openssl</code> only reads the first one.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>grep '^#' tls.crt</code></strong>\n# Classroom Wildcard Certificate\n# GLS Training Classroom Certificate Authority</pre></div></li></ol></li><li class=\"step\"><p>Renew the ingress controller wildcard certificate.\nEnsure the certificate is valid for ten years.</p><ol class=\"substeps\" type=\"1\"><li class=\"step\"><p>Run the <code class=\"code\">renew_wildcard.sh</code> script.\nThe script uses an Ansible Playbook to create a new wildcard certificate with an expiration date set to 3650 days from now (about ten years).\nThe script stores files in the current directory.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>./renew_wildcard.sh</code></strong>\n<span class=\"emphasis\"><em>...output omitted...</em></span>\nTASK [Create a combined certificate] ***************************************\nok: [localhost]\n\nTASK [Create a hard-link to the combined certificate] **********************\nok: [localhost]\n\nPLAY RECAP *****************************************************************\nlocalhost: ok=18   <code class=\"code\">changed=6</code>    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0</pre></li><li class=\"step\"><p>Use the <code class=\"code\">openssl</code> command to verify that the <code class=\"code\">wildcard-combined.pem</code> certificate expires in about ten years.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>openssl x509 \\\n  -in wildcard-combined.pem -noout -subject -issuer -dates -serial</code></strong>\nsubject=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, <code class=\"code\">CN = *.apps.ocp4.example.com</code>\nissuer=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, CN = GLS Training Classroom Certificate Authority\nnotBefore=<em class=\"replaceable\"><code>Oct 29 00:22:34 2021</code></em> GMT\n<code class=\"code\">notAfter=<em class=\"replaceable\"><code>Oct 27 00:22:34 2031</code></em> GMT</code>\nserial=<em class=\"replaceable\"><code>4ABEFC4A1663CBA79C7042FD26DDB4122AD87346</code></em></pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>The <code class=\"code\">wildcard-combined.pem</code> file has two certificates and <code class=\"code\">openssl</code> only reads the first one.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>grep '^#' wildcard-combined.pem</code></strong>\n# Classroom Wildcard Certificate\n# GLS Training Classroom Certificate Authority</pre></div></li></ol></li><li class=\"step\"><p>Update the OpenShift cluster proxy and ingress controller operator.</p><ol class=\"substeps\" type=\"1\"><li class=\"step\"><p>You must also update the TLS secret that the ingress controller uses.\nThe secret resides in the <code class=\"code\">openshift-ingress</code> namespace.</p><p>Update the existing <code class=\"code\">wildcard-tls</code> secret in the <code class=\"code\">openshift-ingress</code> namespace using the renewed <code class=\"code\">wildcard-combined.pem</code> certificate and the existing <code class=\"code\">wildcard-key.pem</code> private key.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc set data \\\n  secret/wildcard-tls -n openshift-ingress \\\n  --from-file tls.crt=wildcard-combined.pem \\\n  --from-file tls.key=wildcard-key.pem</code></strong>\nsecret/wildcard-tls data updated</pre></li></ol></li><li class=\"step\"><p>Confirm the renewal of the ingress controller wildcard certificate.\nFrom the <code class=\"code\">workstation</code> machine, run the following <code class=\"code\">curl</code> command.\nThe output indicates an expiration date of about ten years in the future.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>curl -v -k \\\n  https://console-openshift-console.apps.ocp4.example.com 2&gt;&amp;1 | grep -w date</code></strong>\n*  start date: <em class=\"replaceable\"><code>Oct 29 00:22:34 2021</code></em> GMT\n*  <code class=\"code\">expire date: <em class=\"replaceable\"><code>Oct 27 00:22:34 2031</code></em> GMT</code></pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>It can take a minute before the router pods use the updated certificate.\nYou can get different outputs from the <code class=\"code\">curl</code> command above depending on which router pod processes the request.</p></div></li><li class=\"step\"><p>Review the TLS certificates of the API server.</p><ol class=\"substeps\" type=\"1\"><li class=\"step\"><p>Delete the <code class=\"code\">~/.kube</code> directory and run the <code class=\"code\">oc login</code> command.\nThe message indicates that the API certificate has expired or is not yet valid.\nType <code class=\"code\">y</code> to bypass the certificate check.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>rm -rf ~/.kube</code></strong>\n\n[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc login -u admin -p redhat \\\n  https://api.ocp4.example.com:6443</code></strong>\nThe server is using an invalid certificate: x509: certificate has expired or is not yet valid\nYou can bypass the certificate check, but any data you send to the server could be intercepted by others.\nUse insecure connections? (y/n): <code class=\"code\">y</code>\n\nLogin successful.\n\n<span class=\"emphasis\"><em>...output omitted...</em></span></pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>The start script redeploys the API server pods in the <code class=\"code\">openshift-kube-apiserver</code> namespace using an expiring certificate.\nIf the pods have not finished redeploying, then the <code class=\"code\">invalid certificate</code> warning does not display.\nIt is safe to continue the exercise even if you do not see the warning.</p></div></li><li class=\"step\"><p>The <code class=\"code\">cluster</code> resource is a custom resource of type <code class=\"code\">apiserver</code> and defines the certificate that the API server uses.\nUse the <code class=\"code\">oc get</code> command to review the resource configuration.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc get apiserver/cluster \\\n  -o yaml | tail</code></strong>\n<span class=\"emphasis\"><em>...output omitted...</em></span>\nspec:\n  servingCerts:\n    namedCertificates:\n    - names:\n      - api.ocp4.example.com\n      servingCertificate:\n        name: <code class=\"code\">api-tls</code> <a id=\"certificates-troubleshoot-practice-CO1-1\"></a><span><img alt=\"1\" border=\"0\" src=\"/rol/static/roc/Common_Content/images/1.svg\"/></span></pre><div class=\"calloutlist\"><table border=\"0\" summary=\"Callout list\"><tr><td align=\"left\" valign=\"top\" width=\"5%\"><p><a href=\"#certificates-troubleshoot-practice-CO1-1\"><span><img alt=\"1\" border=\"0\" src=\"/rol/static/roc/Common_Content/images/1.svg\"/></span></a> </p></td><td align=\"left\" valign=\"top\"><p>The secret that contains the certificates.</p></td></tr></table></div></li><li class=\"step\"><p>Extract the <code class=\"code\">api-tls</code> secret and save the output to the current directory.\nThe <code class=\"code\">--confirm</code> option overwrites the files if they already exist in the destination.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc extract secret/api-tls \\\n  -n openshift-config --to ./ --confirm</code></strong>\ntls.crt\ntls.key</pre></li><li class=\"step\"><p>Use the <code class=\"code\">openssl</code> command to read the certificate.\nThe <code class=\"code\">-issuer</code> and <code class=\"code\">-dates</code> options display the certificate authority that issued the certificate and the dates and times of certificate validity.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>openssl x509 -in tls.crt \\\n  -noout -subject -issuer -dates -serial</code></strong>\nsubject=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, <code class=\"code\">CN = api.ocp4.example.com</code>\nissuer=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, CN = GLS Training Classroom Certificate Authority\nnotBefore=<em class=\"replaceable\"><code>Oct 29 00:14:53 2021</code></em> GMT\n<code class=\"code\">notAfter=<em class=\"replaceable\"><code>Oct 29 00:15:53 2021</code></em> GMT</code>\nserial=<em class=\"replaceable\"><code>714A26872F9262B69BC3A52EA55B464E1920EC10</code></em></pre><p>The <code class=\"code\">GLS Training Classroom Certificate Authority</code> CA issued the certificate.\nAlthough your dates are different, expect that the certificate expired because it was only valid for one minute.</p><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>The <code class=\"code\">tls.crt</code> file has two certificates and <code class=\"code\">openssl</code> only reads the first one.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>grep '^#' tls.crt</code></strong>\n# Master API Certificate\n# GLS Training Classroom Certificate Authority</pre></div></li></ol></li><li class=\"step\"><p>Renew the API certificate.</p><ol class=\"substeps\" type=\"1\"><li class=\"step\"><p>Run the <code class=\"code\">renew_api.sh</code> script.\nThe script uses an Ansible Playbook to create a new API certificate with an expiration date set to 3650 days from now (about ten years).\nThe script stores files in the current directory.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>./renew_api.sh</code></strong>\n<span class=\"emphasis\"><em>...output omitted...</em></span>\nTASK [Create a combined certificate] ***************************************\nok: [localhost]\n\nTASK [Create a hard-link to the combined certificate] **********************\nok: [localhost]\n\nPLAY RECAP *****************************************************************\nlocalhost                  : ok=18   <code class=\"code\">changed=6</code>    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0</pre></li><li class=\"step\"><p>List the certificates in the <code class=\"code\">~/DO380/labs/certificates-troubleshoot</code> directory.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>ls *.pem | grep -v key</code></strong>\napi-combined.pem\napi.pem\nwildcard-combined.pem\nwildcard.pem</pre></li><li class=\"step\"><p>Use the <code class=\"code\">openssl</code> command to display information about the <code class=\"code\">api-combined.pem</code> certificate.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>openssl x509 \\\n  -in api-combined.pem -noout -subject -issuer -dates -serial</code></strong>\nsubject=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, <code class=\"code\">CN = api.ocp4.example.com</code>\nissuer=C = US, ST = NC, L = Raleigh, O = \"Red Hat, Inc.\", OU = Training, CN = GLS Training Classroom Certificate Authority\nnotBefore=<em class=\"replaceable\"><code>Oct 29 00:30:20 2021</code></em> GMT\n<code class=\"code\">notAfter=<em class=\"replaceable\"><code>Oct 27 00:30:20 2031</code></em> GMT</code>\nserial=<em class=\"replaceable\"><code>30904D7078C79BB97736D50EC5FC6A21E8EE492F</code></em></pre><p>The output indicates an expiration date of about ten years from now.</p><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>The <code class=\"code\">api-combined.pem</code> file has two certificates and <code class=\"code\">openssl</code> only reads the first one.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>grep '^#' api-combined.pem</code></strong>\n# Master API Certificate\n# GLS Training Classroom Certificate Authority</pre></div></li></ol></li><li class=\"step\"><p>Update the secret for the API certificate.</p><ol class=\"substeps\" type=\"1\"><li class=\"step\"><p>Update the existing <code class=\"code\">api-tls</code> secret in the <code class=\"code\">openshift-config</code> namespace so that it uses the renewed <code class=\"code\">api-combined.pem</code> certificate and the existing <code class=\"code\">api-key.pem</code> private key.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc set data secret/api-tls \\\n  -n openshift-config \\\n  --from-file tls.crt=api-combined.pem \\\n  --from-file tls.key=api-key.pem</code></strong>\nsecret/api-tls data updated</pre></li><li class=\"step\"><p>If the <code class=\"code\">oc set data</code> command succeeds, then the certificate used by each API server pod is updated.\nRun the following command to view the latest events in the <code class=\"code\">openshift-kube-apiserver</code> namespace.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>oc get events \\\n  -n openshift-kube-apiserver --sort-by='.lastTimestamp' | tail</code></strong>\n<span class=\"emphasis\"><em>...output omitted...</em></span>\n60s ... CertificateUpdated ... pod/kube-apiserver-master01 ... <code class=\"code\">Wrote updated secret: openshift-kube-apiserver/user-serving-cert-000</code>\n60s ... CertificateUpdated ... pod/kube-apiserver-master02 ... <code class=\"code\">Wrote updated secret: openshift-kube-apiserver/user-serving-cert-000</code>\n60s ... CertificateUpdated ... pod/kube-apiserver-master03 ... <code class=\"code\">Wrote updated secret: openshift-kube-apiserver/user-serving-cert-000</code></pre></li><li class=\"step\"><p>Change to the <code class=\"code\">/home/student</code> directory.</p><pre class=\"screen\">[student@workstation certificates-troubleshoot]$ <strong class=\"userinput\"><code>cd</code></strong></pre></li><li class=\"step\"><p>Run the following <code class=\"code\">curl</code> command to ensure that the certificate is renewed.</p><pre class=\"screen\">[student@workstation ~]$ <strong class=\"userinput\"><code>curl -v -k https://api.ocp4.example.com:6443 2&gt;&amp;1 | \\\n  grep -w date</code></strong>\n*  start date: <em class=\"replaceable\"><code>Oct 29 00:30:20 2021</code></em> GMT\n*  <code class=\"code\">expire date: <em class=\"replaceable\"><code>Oct 27 00:30:20 2031</code></em> GMT</code>\n&lt; date: <em class=\"replaceable\"><code>Fri, 29 Oct 2021 00:34:29</code></em> GMT</pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>You might need to run the <code class=\"code\">curl</code> command more than once before you see the updated certificate.\nAlthough your dates are different, expect that the certificate expires in about ten years.</p><p>You can get different outputs from the <code class=\"code\">curl</code> command above depending on which API server pod processes the request.</p></div></li><li class=\"step\"><p>Delete the <code class=\"code\">~/.kube</code> directory and run the <code class=\"code\">oc login</code> command.\nEnsure that the warning about an expired certificate no longer displays. If it does, cancel the login operation with <span class=\"keycap\"><strong>Ctrl</strong></span>+<span class=\"keycap\"><strong>C</strong></span> and try again after a few seconds.</p><pre class=\"screen\">[student@workstation ~]$ <strong class=\"userinput\"><code>rm -rf ~/.kube</code></strong>\n\n[student@workstation ~]$ <strong class=\"userinput\"><code>oc login -u admin -p redhat \\\n  https://api.ocp4.example.com:6443</code></strong>\nLogin successful.\n\n<span class=\"emphasis\"><em>...output omitted...</em></span></pre><div class=\"note\" style=\"margin-left: 0.5in; margin-right: 0.5in;\"><h3 class=\"title\">Note</h3><p>You can get different error messages while trying to log into the cluster.\nThis happens because the API server pods are being restarted.\nIt can take ten minutes or more before all of the <code class=\"code\">kube-apiserver</code> finish deploying.</p></div></li></ol></li></ol></div>\n<div class=\"taskrelated\">\n<p><strong>Finish</strong></p><p>On the <code class=\"code\">workstation</code> machine, use the <code class=\"code\">lab</code> command to complete this exercise.\nThis is important to ensure that resources from previous exercises do not impact upcoming exercises.</p>\n<pre class=\"screen\">[student@workstation ~]$ <strong class=\"userinput\"><code>lab certificates-troubleshoot finish</code></strong></pre>\n</div>\n</div></div>"},"parent_id":"certificates","depth":3,"tasks":{"exercise":[{"type":"checklist","mode":"exercise","container":"certificates-troubleshoot-practice","id":"certificates-troubleshoot-practice-task","title":"Guided Exercise: Troubleshooting OpenShift Certificates"}]},"next_tag":"ch06s07","document_index":54,"id_tag":"do380-4.6_certificates-troubleshoot-practice_en-US","path":"/book/chapter[6]/section[6]","next_id":"certificates-troubleshoot-lab","type":"section","children":[]},"type":"course_page","id":1},"links":{"self":"/rol-rhu/api/courses/do380-4.6/pages/ch06s06?lang=en-US"},"warnings":[]}ÌçÊ/xh      bzq bzq DBålbzq    S    :https://role.rhu.redhat.com/rol-rhu/api/courses/do380-4.6/pages/ch06s06?lang=en-US necko:classified 1 strongly-framed 1 security-info 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 request-method GET request-Accept application/json, text/plain, */* request-Accept-Language en-US,en;q=0.5 request-Cookie dQTldEjgkLIKMDCZwRE/MbDH9/c= response-head HTTP/2.0 200 OK
server: nginx
date: Tue, 10 May 2022 14:08:10 GMT
content-type: application/json
vary: Accept, Accept-Language, Cookie
content-language: en
allow: GET, HEAD, OPTIONS
x-frame-options: SAMEORIGIN
x-content-type-options: nosniff
strict-transport-security: max-age=31536000; includeSubDomains
x-xss-protection: 1; mode=block
content-security-policy: base-uri 'self';
timing-allow-origin: *
X-Firefox-Spdy: h2
 original-response-headers server: nginx
date: Tue, 10 May 2022 14:08:10 GMT
content-type: application/json
vary: Accept, Accept-Language, Cookie
content-language: en
allow: GET, HEAD, OPTIONS
x-frame-options: SAMEORIGIN
x-content-type-options: nosniff
strict-transport-security: max-age=31536000; includeSubDomains
x-xss-protection: 1; mode=block
content-security-policy: base-uri 'self';
timing-allow-origin: *
X-Firefox-Spdy: h2
 ctid 1 eTLD1Access 1;0;3423907821, net-response-time-onstart 129 net-response-time-onstop 148   l